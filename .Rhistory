a<-a[c(3,2),] #need to have no mort first row, mort second
row.names(a)<-c(0,1)
a<-as.matrix(a)
ch0[[i]]<-a
}
#run CA test over matrix list; format needs to match format in ?Cochran-Armitage 'dose' ex
CA_increasing_trend<-lapply(ch0,function(x) CochranArmitageTest(x,'increasing'))
CA_increasing_trend
#none fail to reject the null hypothesis for glyphosate
#group by study, species, and application rate
effects<-effects %>%
group_by(Study) %>% #study
group_by(Species) %>% #species
group_by(Application_Rate)%>% #application rate
mutate(SE = SD/sqrt(length(effects))) #mutate to add standard error to account for variability between studies
effects<-as.data.frame(effects)
#effects<-na.omit(effects)
controls<-effects[effects$Application_Rate == 0, ]  #take out all controls
control<-effects[1,] # take out single row which will contain final control
#function for weighted mean
weight_mean<-function(data,vector,weight){
round(with(data, sum(vector*weight)/sum(weight)),2)
}
control$Survival<-weight_mean(controls,controls$Survival, controls$N_Exp) #survival
control$N_Exp<-sum(controls$N_Exp)#use sum of the N used in dose for final N_exp
effects<-effects[!effects$Application_Rate == 0, ] #remove application rate of 0
effects<-rbind(effects,control)
effects$adj_sur_96<-effects$Survival
effects<-na.omit(effects)
effects <-effects[order(effects$Study),]
fam<-as.data.frame(cbind(effects$Family, effects$Study, effects$Application_Rate))
names(fam)<-c('Family', 'Study', "Application")
mod_As<- merge(fam,mod, by  = "Family")
mod_As<-mod_As[order(mod_As$Study),]
pmolweight<-169.1 #g/mol #comptox
plogKow<- -3.12 #comptox
kp_pyra =  10^(-2.72+(0.71*plogKow)-(0.0061*pmolweight))
hl<-4.46*24 #from comptox profile
dt<-param[1,2]
move_rate<-param[3,2]
bioavail<-param[5,2]
dsa<-param[9,2]*effects$Body_Weight_g^param[9,2]
derm_frac<-param[11,2]
soil_concs_deg<-log(2)/hl*96/move_rate #with adjusted time of 96h to match adjusted survival
soil_concs<-((effects$Application_Rate*10)/16000)*1000 #1cm mixing depth; or change depending on soil?
dermal_dose<-(soil_concs^soil_concs_deg * kp_pyra * (dsa/dt) * derm_frac * bioavail)/effects$Body_Weight_g
head(dermal_dose) #take a look
effects$dermaldose<-dermal_dose
effects$Mortality<-1-effects$adj_sur_96
bw_effect<-effects$Body_Weight_g
exp<-bw_effect^mod_As$Exponent
as_d<-mod_As$Modifier*exp
# 50% SA
derm_d<-effects$dermaldose
app_d<-as.numeric(effects$Application_Rate)
derm_original<-derm_d*((as_d*app_d)/2) #modify the calculated dermal dose by the SA and application rate product
TCR_org_50<-as.data.frame(derm_original/effects$dermaldose) #this calculates the ratio between the direct (overspray) and indirect (soil)
names(TCR_org_50)<-"TCR"
TCR_org_50$Family<-effects$Family #add family
TCR_org_50<-na.omit(TCR_org_50)
TCR_org_50_r<- TCR_org_50 %>%
group_by(Family) %>%
summarise(TCR_r = mean(TCR))
print(TCR_org_50_r$TCR_r)
print(TCR_org_50_r$Family)
effects$dermaldose<-derm_original
effects<-effects[with(effects, order(Study, Species, Application_Rate)), ]
effects$death<-round(effects$Mortality*effects$N_Exp,0)
#effects<-effects[order(effects$dermaldose),]
effects$Exp<-ifelse(effects$Method=="Overspray",1,0)
og_data<-matrix(0,nrow=nrow(effects), ncol=5)
colnames(og_data) <- c("Dose","N","Incidence", "Exp","BW")
og_data[,1] <- effects$dermaldose
og_data[,2] <- effects$N_Exp
og_data[,3] <- effects$death
og_data[,4] <- effects$Exp
og_data[,5] <- effects$Body_Weight_g
round(1-(og_data[,3]/og_data[,2]),3)
print(sims[1:39,4])
print(effects$death)
max(sims[,2])
#### time to get the upper and lower bounds out of the 1000 curves ----
#post-process all data for credible intervals
d<-og_data[,1]
nd<-length(by_s[[1]]$Dose)
nsims <- 1000
mortality_df <- matrix(ncol = nsims, nrow = nd)
for(i in 1:length(by_s)){
parms <- gam_fit[[i]]$parameters
g <-  1/(1+exp(-parms[1]));
a <- parms[2];
b <- parms[3];
mortality_df[,i] <- g + (1-g)*pgamma(b*d,a,1)
} #
percentiles_df <- matrix(ncol = 3, nrow = nd)
for(i in 1:nd){
mort_percentiles <- quantile(mortality_df[i,], probs = c(0.025,0.50, 0.975), names=T)
percentiles_df[i,1] <- mort_percentiles[[1]]
# percentiles_df[i,2] <- mort_percentiles[[2]]
# percentiles_df[i,3] <- mort_percentiles[[3]]
percentiles_df[i,2] <- mort_percentiles[[2]]
# percentiles_df[i,5] <- mort_percentiles[[5]]
# percentiles_df[i,6] <- mort_percentiles[[6]]
percentiles_df[i,3] <- mort_percentiles[[3]]
}
dim(percentiles_df)
df_percentiles <- data.frame(x=d, val= as.vector(percentiles_df),
variable=rep(paste0("category", 1:3), each=39))
gam_laplace<-single_dichotomous_fit(og_data[,1],og_data[,3],og_data[,2],model_type="gamma",fit_type="laplace")
parms <- gam_laplace$parameters
g <-  1/(1+exp(-parms[1]));
a <- parms[2];
b <- parms[3];
rval_og <- g + (1-g)*pgamma(b*d,a,1)
df<-as.data.frame(cbind(rval_og,d))
names(df)<-c("effect","dose")
lerror<-df_percentiles[df_percentiles$variable == "category1",2]
median<-df_percentiles[df_percentiles$variable == "category2",2]
uerror<-df_percentiles[df_percentiles$variable == "category3",2]
med_data<-as.data.frame(cbind(median,df$dose))
og_data<-as.data.frame(og_data)
og_data[,5]<-as.character(og_data[,5])
my_breaks_m<-c(0,0.020,0.040,0.060)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=dose, y=effect))+
geom_ribbon(aes(x = df$dose, ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=Dose,y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("Dose (ug/g)")+
scale_x_continuous(limits=c(0,0.065),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("Dose (ug/g)")+
scale_x_continuous(limits=c(-5,0.065),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
my_breaks_m<-c(-5,-3,-1,0)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("Dose (ug/g)")+
scale_x_continuous(limits=c(-5,0),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("Dose (ug/g)")+
scale_x_continuous(limits=c(-7,0),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
my_breaks_m<-c(-7,-3,-2.7)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("Dose (ug/g)")+
scale_x_continuous(limits=c(-7,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
my_breaks_m<-c(-7,-5,-3,-2.7)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("Dose (ug/g)")+
scale_x_continuous(limits=c(-7,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
ld50<-read.csv('data_in/ld50_glypho.csv')
#ld50<-ld50[!ld50$LD50>100,]
cons<-sort(ld50$LD50)[1:5]
ld50c<-ld50[ld50$LD50 %in% cons,]
frog<-c(0.002980385, 0.000480939)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-7,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
ld50<-read.csv('data_in/ld50_glypho.csv')
#ld50<-ld50[!ld50$LD50>100,]
cons<-sort(ld50$LD50)[1:5]
ld50c<-ld50[ld50$LD50 %in% cons,]
frog<-c(0.002980385, 0.000480939)
min(cons)
max(cons)
mean(cons)
frog<-ld50[ld50$LD50 %in% frog,]
my_breaks<-c(-7,-5,-3,-2.7)
bmds_hist_gly<-
ggplot(data=bmds,aes(x=log(BMDSEstimates), y=..count..,group=order, fill=order))+
geom_histogram(bins=100)+
ylab("Density BMDs") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-7,-2.7), breaks=round(my_breaks,2), expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position="none")
bmds_hist_gly
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-8,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
bmds_hist_gly<-
ggplot(data=bmds,aes(x=log(BMDSEstimates), y=..count..,group=order, fill=order))+
geom_histogram(bins=100)+
ylab("Density BMDs") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-8,-2.7), breaks=round(my_breaks,2), expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position="none")
bmds_hist_gly
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-7,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-6.9,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
my_breaks_m<-c(-6.9,-5,-3,-2.7)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-6.9,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
i
my_breaks_m<-c(-7,-5,-3,-2.7)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-7,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
ld50<-read.csv('data_in/ld50_glypho.csv')
#ld50<-ld50[!ld50$LD50>100,]
cons<-sort(ld50$LD50)[1:5]
ld50c<-ld50[ld50$LD50 %in% cons,]
frog<-c(0.002980385, 0.000480939)
min(cons)
max(cons)
mean(cons)
frog<-ld50[ld50$LD50 %in% frog,]
my_breaks<-c(-7,-5,-3,-2.7)
bmds_hist_gly<-
ggplot(data=bmds,aes(x=log(BMDSEstimates), y=..count..,group=order, fill=order))+
geom_histogram(bins=100)+
ylab("Density BMDs") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-7,-2.7), breaks=round(my_breaks,2), expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position="none")
bmds_hist_gly
final_glypho<-main +
geom_boxplot(data=ld50c, aes(x=log(LD50), y=Mortality), width=0.05) +
geom_vline(xintercept=log(frog[1,1]), linetype='dotted', col = 'red')+
geom_vline(xintercept=log(frog[2,1]), linetype='dotted', col = 'red')+
# geom_point(data=frog, aes(x=LD50,y=Mortality),colour="black", shape=18, size=4) +
geom_point(aes(x=log(0.017),y=0.50),colour="red")
grid.arrange(final_glypho, bmds_hist_gly,nrow=2,heights=c(4.5,1.5))
ld50c
log(frog[1,1])
log(frog[2,1])
og(0.017)
log(0.017)
my_breaks_m<-c(-8,-5,-3,-2.7)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-8,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
ld50<-read.csv('data_in/ld50_glypho.csv')
#ld50<-ld50[!ld50$LD50>100,]
cons<-sort(ld50$LD50)[1:5]
ld50c<-ld50[ld50$LD50 %in% cons,]
frog<-c(0.002980385, 0.000480939)
min(cons)
max(cons)
mean(cons)
frog<-ld50[ld50$LD50 %in% frog,]
my_breaks<-c(-8,-5,-3,-2.7)
bmds_hist_gly<-
ggplot(data=bmds,aes(x=log(BMDSEstimates), y=..count..,group=order, fill=order))+
geom_histogram(bins=100)+
ylab("Density BMDs") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-8,-2.7), breaks=round(my_breaks,2), expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position="none")
bmds_hist_gly
final_glypho<-main +
geom_boxplot(data=ld50c, aes(x=log(LD50), y=Mortality), width=0.05) +
geom_vline(xintercept=log(frog[1,1]), linetype='dotted', col = 'red')+
geom_vline(xintercept=log(frog[2,1]), linetype='dotted', col = 'red')+
# geom_point(data=frog, aes(x=LD50,y=Mortality),colour="black", shape=18, size=4) +
geom_point(aes(x=log(0.017),y=0.50),colour="red")
grid.arrange(final_glypho, bmds_hist_gly,nrow=2,heights=c(4.5,1.5))
bmds_hist_gly
log(ld50c$LD50)
my_breaks_m<-c(-10,-5,-3,-2.7)
main<-ggplot() +
#geom_density(data=bmds_df, aes(x=bmds))+
geom_line(data = df, aes(x=log(dose), y=effect))+
geom_ribbon(aes(x = log(df$dose), ymin =lerror, ymax = uerror), alpha = .2) +
geom_point(data=og_data, aes(x=log(Dose),y=(Incidence/N), colour=Exp, fill=Exp))+
ggtitle("Gamma Glyphosate Curve") +
ylab("Mortality") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-10,-2.7),breaks=my_breaks_m,expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position = 'none') #first run without this to get legend
main
ld50<-read.csv('data_in/ld50_glypho.csv')
#ld50<-ld50[!ld50$LD50>100,]
cons<-sort(ld50$LD50)[1:5]
ld50c<-ld50[ld50$LD50 %in% cons,]
frog<-c(0.002980385, 0.000480939)
min(cons)
max(cons)
mean(cons)
frog<-ld50[ld50$LD50 %in% frog,]
my_breaks<-c(-10,-5,-3,-2.7)
bmds_hist_gly<-
ggplot(data=bmds,aes(x=log(BMDSEstimates), y=..count..,group=order, fill=order))+
geom_histogram(bins=100)+
ylab("Density BMDs") +
xlab("log(Dose (ug/g))")+
scale_x_continuous(limits=c(-10,-2.7), breaks=round(my_breaks,2), expand = c(0, 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size= 12, face='bold'),
axis.text.y = element_text(size=12, face='bold'),
axis.title.x = element_text(size=14, face='bold'),
axis.title.y = element_text(size=14, face='bold'),
plot.title = element_text(face = 'bold', size = 16), legend.position="none")
bmds_hist_gly
final_glypho<-main +
geom_boxplot(data=ld50c, aes(x=log(LD50), y=Mortality), width=0.05) +
geom_vline(xintercept=log(frog[1,1]), linetype='dotted', col = 'red')+
geom_vline(xintercept=log(frog[2,1]), linetype='dotted', col = 'red')+
# geom_point(data=frog, aes(x=LD50,y=Mortality),colour="black", shape=18, size=4) +
geom_point(aes(x=log(0.017),y=0.50),colour="red")
grid.arrange(final_glypho, bmds_hist_gly,nrow=2,heights=c(4.5,1.5))
